# fun-with-source-generator
Okay, i have a confession.. What i accutally wanted to do was to see if i could create a ``service provider`` thats generated at compile time. If that sounds awesome, and you need something like that, then take a look at https://github.com/pakrym/jab

Of course your also welcome to get inspired from this repo.


By the time of this commit the status is like this.

Services defined like this with an attribute- note that lifetime is not implemented:
```csharp
public interface IMyObject { }

[ServiceAttribute<IMyObject>(Lifetime = ServiceLifetime.Singleton)]
public class MyObject : IMyObject
{
    private readonly MyObjectDependency _dependency;
    public MyObject(MyObjectDependency dependency)
    {
        _dependency = dependency;
    }
}

[ServiceAttribute<MyObjectDependency>]
public class MyObjectDependency
{

}
```

Services can be accessed on the container instance- which is a singleton:
```csharp
var instance = Container.Instance;

var container = instance.GetService(typeof(IServiceProvider));
// instance == container (this is the same object)
var myObject = instance.GetService(typeof(IMyObject));
// myObject has a MyObjectDependency inside of it
```

The following code are generated:
```csharp
// <auto-generated/>
using System;
using System.Runtime.CompilerServices;
#nullable enable

public partial class Container
{
    static Container()
    {
        Instance = new ContainerImpl();
    }
    
    private class ContainerImpl : IContainer
    {
        private IMyObject? _IMyObject = null;
        private MyObjectDependency? _MyObjectDependency = null;
                
        public object? GetService(Type serviceType)
        {
            if (serviceType == typeof(IMyObject))
            {
                return CreateIMyObject();
            }
            if (serviceType == typeof(MyObjectDependency))
            {
                return CreateMyObjectDependency();
            }
            if (serviceType == typeof(IServiceProvider))
            {
                return this;
            }
            if (serviceType == typeof(IContainer))
            {
                return this;
            }
            return null;
        }
        
        [MethodImpl(MethodImplOptions.AggressiveInlining)]
        private IMyObject CreateIMyObject()
        {
            var dependency = CreateMyObjectDependency();
            return new MyObject(dependency);
        }
        
        [MethodImpl(MethodImplOptions.AggressiveInlining)]
        private MyObjectDependency CreateMyObjectDependency()
        {
            return new MyObjectDependency();
        }
    }
}
```

                
